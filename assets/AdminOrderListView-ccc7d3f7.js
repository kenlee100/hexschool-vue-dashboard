import{m as T,M as O,P as x,D as P}from"./PaginationComponent-870b07ad.js";import{_ as w,o as l,c as d,a as t,t as o,j as L,w as y,k as C,F as h,h as g,r as _,f as m}from"./index-2add07e7.js";import{t as u}from"./toast-cf222e50.js";import{u as p}from"./common-5d0607d3.js";const V={data(){return{modal:{},newTempContent:{}}},props:{tempContent:{type:Object,default(){}},isNew:{type:Boolean,default:!1}},watch:{tempContent(){this.newTempContent=this.tempContent}},mixins:[T],mounted(){this.$refs.modal.addEventListener("hidden.bs.modal",()=>{this.newTempContent={}}),this.modal=new O(this.$refs.modal,{backdrop:"static",keyboard:!1})}},D={ref:"modal",class:"modal fade"},E={class:"modal-dialog modal-xl"},I={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},U=t("h5",{id:"productModalLabel",class:"modal-title"},[t("span",null,"訂單細節")],-1),A={class:"modal-body"},S={class:"row"},B={class:"col-md-6"},J=t("h3",null,"用戶資料",-1),R={class:"table table-striped table-hover mb-0"},j={key:0},F=t("th",{style:{width:"100px"}},"姓名",-1),H=t("th",null,"Email",-1),q=t("th",null,"電話",-1),z=t("th",null,"地址",-1),G={class:"col-md-6"},K=t("h3",null,"訂單細節",-1),Q={class:"table table-striped table-hover mb-0"},W=t("th",{style:{width:"100px"}},"訂單編號",-1),X=t("th",null,"下單時間",-1),Y=t("th",null,"付款時間",-1),Z={key:0},tt={key:1},et=t("th",null,"付款狀態",-1),st={key:0,class:"text-success"},nt={key:1,class:"text-muted"},ot=t("th",null,"總金額",-1),lt={class:"d-flex justify-content-end py-3"},dt={class:"form-check form-switch"},it={class:"form-check-label",for:"switch-paid"},at={key:0,class:"text-success"},rt={key:1,class:"text-danger"},ct={class:"row"},pt=t("h3",null,"選購商品",-1),ut={class:"table"},ht=t("thead",null,[t("tr")],-1),_t={class:"text-end"},mt={class:"modal-footer"};function bt(n,e,k,v,s,r){return l(),d("div",D,[t("div",E,[t("div",I,[t("div",N,[U,t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...a)=>n.closeModal&&n.closeModal(...a))})]),t("div",A,[t("div",S,[t("div",B,[J,t("table",R,[s.newTempContent.user?(l(),d("tbody",j,[t("tr",null,[F,t("td",null,o(s.newTempContent.user.name),1)]),t("tr",null,[H,t("td",null,o(s.newTempContent.user.email),1)]),t("tr",null,[q,t("td",null,o(s.newTempContent.user.tel),1)]),t("tr",null,[z,t("td",null,o(s.newTempContent.user.address),1)])])):L("",!0)])]),t("div",G,[K,t("table",Q,[t("tbody",null,[t("tr",null,[W,t("td",null,o(s.newTempContent.id),1)]),t("tr",null,[X,t("td",null,o(n.$filters.date(s.newTempContent.create_at)),1)]),t("tr",null,[Y,t("td",null,[s.newTempContent.paid_date?(l(),d("span",Z,o(n.$filters.date(s.newTempContent.paid_date)),1)):(l(),d("span",tt,"時間不正確"))])]),t("tr",null,[et,t("td",null,[s.newTempContent.is_paid?(l(),d("strong",st,"已付款")):(l(),d("span",nt,"尚未付款"))])]),t("tr",null,[ot,t("td",null,"$"+o(n.$filters.currency(s.newTempContent.total)),1)])])]),t("div",lt,[t("div",dt,[y(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"switch-paid","onUpdate:modelValue":e[1]||(e[1]=a=>s.newTempContent.is_paid=a)},null,512),[[C,s.newTempContent.is_paid]]),t("label",it,[s.newTempContent.is_paid?(l(),d("span",at,"已付款")):(l(),d("span",rt,"未付款"))])])])])]),t("div",ct,[t("div",null,[pt,t("table",ut,[ht,t("tbody",null,[(l(!0),d(h,null,g(s.newTempContent.products,a=>(l(),d("tr",{key:a.id},[t("th",null,o(a.product.title),1),t("td",null,o(a.qty)+" / "+o(a.product.unit),1),t("td",_t," $"+o(n.$filters.currency(a.final_total)),1)]))),128))])])])])]),t("div",mt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=(...a)=>n.closeModal&&n.closeModal(...a))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=a=>n.$emit("update-paid",s.newTempContent))}," 修改付款狀態 ")])])])],512)}const ft=w(V,[["render",bt]]),{VITE__URL:b,VITE__PATH:f}={VITE__PATH:"ken100",VITE__URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-dashboard",MODE:"production",DEV:!1,PROD:!0},gt={data(){return{orders:[],temp:{},pagination:{},productId:""}},components:{PaginationComponent:x,AdminOrderModal:ft,DelModal:P},methods:{getOrder(n=1){p().isLoading=!0,this.$http.get(`${b}/api/${f}/admin/orders/?page=${n}`).then(e=>{this.orders=e.data.orders,this.pagination=e.data.pagination,p().isLoading=!1}).catch(e=>{p().isLoading=!1,u.fire({icon:"error",title:`${e.response.data.message}`})})},deleteItem(n){p().isProcessing=!0,this.$http.delete(`${b}/api/${f}/admin/order/${n}`).then(e=>{this.$refs.deleteOrderModal.closeModal(),this.getOrder(),u.fire({icon:"success",title:e.data.message})}).catch(e=>{u.fire({icon:"error",title:`${e.response.data.message}`})})},openModal(n,e){n==="view"?(this.temp=JSON.parse(JSON.stringify(e)),this.$refs.orderModal.openModal()):n==="delete"&&(this.temp=JSON.parse(JSON.stringify(e)),this.$refs.deleteOrderModal.openModal())},updatePaid(n){this.$http.put(`${b}/api/${f}/admin/order/${n.id}`,{data:{is_paid:n.is_paid}}).then(e=>{this.getOrder(),this.$refs.orderModal.closeModal(),u.fire({icon:"success",title:e.data.message})}).catch(e=>{p().isLoading=!1,u.fire({icon:"error",title:`${e.response.data.message}`})})}},mounted(){p().isLoading=!0,this.getOrder()}},wt={class:"mt-4 mb-4 p-3 bg-white shadow-sm"},yt={class:"table-responsive"},Ct={class:"table table-striped table-hover mb-0"},kt=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"購買時間"),t("th",null,"客戶資訊"),t("th",null,"購買品項"),t("th",{class:"text-end"},"應付金額"),t("th",{width:"120"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),vt={class:"list-unstyled mb-0"},$t=t("span",null,"訂單編號：",-1),Mt=t("span",null,"姓名：",-1),Tt=t("span",null,"Email：",-1),Ot={class:"list-group list-group-numbered mb-0"},xt={class:"text-end"},Pt={class:"form-check form-switch"},Lt=["id","onUpdate:modelValue","onChange"],Vt=["for"],Dt={key:0,class:"text-success"},Et={key:1,class:"text-danger"},It={class:"btn-group"},Nt=["onClick"],Ut=["onClick"];function At(n,e,k,v,s,r){const a=_("AdminOrderModal"),$=_("DelModal"),M=_("PaginationComponent");return l(),d(h,null,[t("div",wt,[t("div",yt,[t("table",Ct,[kt,t("tbody",null,[(l(!0),d(h,null,g(s.orders,i=>(l(),d("tr",{key:i.id},[t("td",null,o(n.$filters.date(i.create_at)),1),t("td",null,[t("ul",vt,[t("li",null,[$t,t("span",null,o(i.id),1)]),t("li",null,[Mt,t("span",null,o(i.user.name),1)]),t("li",null,[Tt,t("span",null,o(i.user.email),1)])])]),t("td",null,[t("ol",Ot,[(l(!0),d(h,null,g(i.products,c=>(l(),d("li",{class:"list-group-item ps-0 border border-0 bg-transparent",key:c.id},o(c.product.title),1))),128))])]),t("td",xt,"$"+o(i.total),1),t("td",null,[t("div",Pt,[y(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:i.id,"onUpdate:modelValue":c=>i.is_paid=c,onChange:c=>r.updatePaid(i)},null,40,Lt),[[C,i.is_paid]]),t("label",{class:"form-check-label",for:i.id},[i.is_paid?(l(),d("span",Dt,"已付款")):(l(),d("span",Et,"未付款"))],8,Vt)])]),t("td",null,[t("div",It,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>r.openModal("view",i)}," 檢視 ",8,Nt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>r.openModal("delete",i)}," 刪除 ",8,Ut)])])]))),128))])])])]),m(a,{ref:"orderModal","temp-content":s.temp,onUpdatePaid:r.updatePaid},null,8,["temp-content","onUpdatePaid"]),m($,{ref:"deleteOrderModal",item:s.temp,onDeleteItem:r.deleteItem,"item-title":s.temp.id},null,8,["item","onDeleteItem","item-title"]),m(M,{pages:s.pagination,onChangePage:r.getOrder,"get-list":r.getOrder},null,8,["pages","onChangePage","get-list"])],64)}const jt=w(gt,[["render",At]]);export{jt as default};
