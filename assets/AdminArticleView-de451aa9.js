import{m as U,M as L,D as N,P as D}from"./PaginationComponent-314f6a30.js";import{C as I}from"./ckeditor-5b93060f.js";import{_ as A,r as h,o as a,c,a as e,f as r,g as E,n as x,w as g,v as T,F as M,h as $,j as S,k as P,t as w}from"./index-4cba5261.js";import{t as u}from"./toast-ffc4b616.js";import{u as i}from"./common-f565fb83.js";const O={data(){return{modal:{},newTempContent:{tag:[]},create_at:0,editor:I,editorConfig:{toolbar:["heading","bold","italic","|","link"]}}},props:{tempContent:{type:Object,default(){}},isNew:{type:Boolean,default:!1}},watch:{tempContent(){this.newTempContent={...this.tempContent,tag:this.tempContent.tag||[],isPublic:this.tempContent.isPublic||!1},[this.create_at,this.secondVal]=new Date(this.newTempContent.create_at*1e3).toISOString().split("T")},create_at(){this.newTempContent.create_at=Math.floor(new Date(this.create_at)/1e3)}},mixins:[U],mounted(){this.$refs.modal.addEventListener("hidden.bs.modal",()=>{this.newTempContent={tag:[]}}),this.modal=new L(this.$refs.modal,{backdrop:"static",keyboard:!1})}},F={ref:"modal",class:"modal fade"},B={class:"modal-dialog modal-xl"},J={class:"modal-content border-0"},R={class:"modal-header bg-dark text-white"},j={class:"modal-title"},q={key:0},H={key:1},z={class:"modal-body"},G={class:"row"},K={class:"col-sm-4"},Q={class:"mb-3"},W=e("label",{for:"title",class:"form-label"},"標題",-1),X={class:"mb-3"},Y=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),Z=["src"],ee={class:"mb-3"},te=e("label",{for:"author",class:"form-label"},"作者",-1),se={class:"mb-3"},oe=e("label",{for:"create_at"},"文章建立日期",-1),ne=["min"],le={class:"col-sm-8"},ie=e("label",{for:"tag",class:"form-label"},"標籤",-1),ae={class:"row gx-1 mb-3"},ce={class:"input-group input-group-sm"},de=["onUpdate:modelValue"],re=["onClick"],me=e("i",{class:"bi bi-x"},null,-1),pe=[me],ue={key:0,class:"col-auto mb-1"},he={class:"mb-3"},_e=e("label",{for:"description",class:"form-label"},"文章描述",-1),be={class:"mb-3"},ge={class:"mb-3"},fe={class:"form-check form-switch"},we={class:"form-check-label",for:"switch-public"},Ce={key:0,class:"text-success"},ve={key:1,class:"text-danger"},ye={class:"modal-footer"},Te={type:"submit",class:"btn btn-primary"};function ke(o,t,m,f,s,d){const C=h("VField"),v=h("ErrorMessage"),k=h("ckeditor"),l=h("VForm");return a(),c("div",F,[e("div",B,[e("div",J,[r(l,{onSubmit:t[10]||(t[10]=p=>o.$emit("update-article",s.newTempContent))},{default:E(({errors:p})=>[e("div",R,[e("h5",j,[m.isNew?(a(),c("span",q,"新增貼文")):(a(),c("span",H,"編輯貼文"))]),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...n)=>o.closeModal&&o.closeModal(...n))})]),e("div",z,[e("div",G,[e("div",K,[e("div",Q,[W,r(C,{type:"text",name:"title",label:"標題",class:x(["form-control",{"is-invalid":p.title}]),id:"title",rules:"required",modelValue:s.newTempContent.title,"onUpdate:modelValue":t[1]||(t[1]=n=>s.newTempContent.title=n),placeholder:"請輸入標題"},null,8,["class","modelValue"]),r(v,{name:"title",class:"text-danger"})]),e("div",X,[Y,g(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[2]||(t[2]=n=>s.newTempContent.imageUrl=n),placeholder:"請輸入圖片連結"},null,512),[[T,s.newTempContent.imageUrl]]),e("img",{class:"img-fluid",src:s.newTempContent.imageUrl,alt:""},null,8,Z)]),e("div",ee,[te,r(C,{type:"text",name:"author",label:"作者",class:x(["form-control",{"is-invalid":p.author}]),id:"author",rules:"required",modelValue:s.newTempContent.author,"onUpdate:modelValue":t[3]||(t[3]=n=>s.newTempContent.author=n),placeholder:"請輸入標題"},null,8,["class","modelValue"]),r(v,{name:"author",class:"text-danger"})]),e("div",se,[oe,g(e("input",{type:"date",min:s.create_at,class:"form-control",id:"create_at","onUpdate:modelValue":t[4]||(t[4]=n=>s.create_at=n)},null,8,ne),[[T,s.create_at]])])]),e("div",le,[ie,e("div",ae,[(a(!0),c(M,null,$(s.newTempContent.tag,(n,y)=>(a(),c("div",{class:"col-md-2 mb-1",key:y},[e("div",ce,[g(e("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":V=>s.newTempContent.tag[y]=V,placeholder:"請輸入標籤"},null,8,de),[[T,s.newTempContent.tag[y]]]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:V=>s.newTempContent.tag.splice(y,1)},pe,8,re)])]))),128)),s.newTempContent.tag[s.newTempContent.tag.length-1]||!s.newTempContent.tag.length?(a(),c("div",ue,[e("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:t[5]||(t[5]=n=>s.newTempContent.tag.push(""))}," 新增標籤 ")])):S("",!0)]),e("div",he,[_e,g(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":t[6]||(t[6]=n=>s.newTempContent.description=n),placeholder:"請輸入文章描述"},null,512),[[T,s.newTempContent.description]])]),e("div",be,[r(k,{editor:s.editor,config:s.editorConfig,modelValue:s.newTempContent.content,"onUpdate:modelValue":t[7]||(t[7]=n=>s.newTempContent.content=n)},null,8,["editor","config","modelValue"])]),e("div",ge,[e("div",fe,[g(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"switch-public","onUpdate:modelValue":t[8]||(t[8]=n=>s.newTempContent.isPublic=n)},null,512),[[P,s.newTempContent.isPublic]]),e("label",we,[s.newTempContent.isPublic?(a(),c("span",Ce,"公開")):(a(),c("span",ve,"不公開"))])])])])])]),e("div",ye,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[9]||(t[9]=(...n)=>o.closeModal&&o.closeModal(...n))}," 取消 "),e("button",Te,w(m.isNew?"確認新增":"確認修改"),1)])]),_:1})])])],512)}const Me=A(O,[["render",ke]]),{VITE__URL:_,VITE__PATH:b}={VITE__PATH:"ken100",VITE__URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-dashboard",MODE:"production",DEV:!1,PROD:!0},Ve={data(){return{modal:{},articles:[],temp:{isPublic:!1,create_at:new Date().getTime()/1e3,tag:[]},pagination:{},isNew:!1}},methods:{getArticles(o=1){i().isLoading=!0,this.$http.get(`${_}/api/${b}/admin/articles/?page=${o}`).then(t=>{this.articles=t.data.articles,this.pagination=t.data.pagination,i().isLoading=!1}).catch(t=>{i().isLoading=!1,u.fire({icon:"error",title:`${t.response.data.message}`})})},getArticleItem(o){i().isLoading=!0,this.$http.get(`${_}/api/${b}/admin/article/${o}`).then(t=>{this.openModal("edit",t.data.article),i().isLoading=!1}).catch(t=>{i().isLoading=!1,u.fire({icon:"error",title:`${t.response.data.message}`})})},openModal(o,t){o==="new"?(this.isNew=!0,this.$refs.articleModal.openModal(),this.temp={isPublic:!1,create_at:new Date().getTime()/1e3,tag:[]}):o==="edit"?(this.isNew=!1,this.temp=JSON.parse(JSON.stringify(t)),this.$refs.articleModal.openModal()):o==="delete"&&(this.temp=JSON.parse(JSON.stringify(t)),this.$refs.deleteModal.openModal())},deleteItem(o){i().isLoading=!0,this.$http.delete(`${_}/api/${b}/admin/article/${o}`).then(t=>{this.getArticles(),this.$refs.deleteModal.closeModal(),u.fire({icon:"success",title:t.data.message})}).catch(t=>{i().isLoading=!1,u.fire({icon:"error",title:`${t.response.data.message}`})})},async updateArticle(o){i().isLoading=!0;let t=`${_}/api/${b}/admin/article`,m="post";this.isNew||(t=`${_}/api/${b}/admin/article/${o.id}`,m="put"),this.$http[m](t,{data:o}).then(f=>{this.$refs.articleModal.closeModal(),this.getArticles(),this.isNew=!1,u.fire({icon:"success",title:f.data.message})}).catch(f=>{i().isLoading=!1,u.fire({icon:"error",title:`${f.response.data.message}`})})},async switchUpdate(o){i().isLoading=!0;try{const m={...(await this.$http.get(`${_}/api/${b}/admin/article/${o.id}`)).data.article,isPublic:o.isPublic};await this.updateArticle(m)}catch(t){i().isLoading=!1,u.fire({icon:"error",title:`${t.response.data.message}`})}}},mounted(){i().isLoading=!0,this.getArticles()},components:{AdminArticleModalVue:Me,DelModal:N,PaginationComponent:D}},xe={class:"text-end mt-4"},Ae={class:"mt-4 mb-4 p-3 bg-white shadow-sm"},$e={class:"table-responsive"},Pe={class:"table table-striped table-hover mb-0"},Ue=e("thead",{class:"table-light"},[e("tr",null,[e("th",{style:{width:"200px"}},"標題"),e("th",{style:{width:"100px"}},"作者"),e("th",{style:{width:"200px"}},"描述"),e("th",{style:{width:"100px"}},"建立時間"),e("th",{style:{width:"100px"}},"是否公開"),e("th",{style:{width:"120px"}},"編輯")])],-1),Le={class:"mb-0 line-clamp-2"},Ne={class:"mb-0 line-clamp-2"},De={class:"form-check form-switch"},Ie=["id","onUpdate:modelValue","onChange"],Ee=["for"],Se={key:0,class:"text-success"},Oe={key:1,class:"text-danger"},Fe={class:"btn-group"},Be=["onClick"],Je=["onClick"];function Re(o,t,m,f,s,d){const C=h("AdminArticleModalVue"),v=h("DelModal"),k=h("PaginationComponent");return a(),c(M,null,[e("div",xe,[e("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=l=>d.openModal("new"))}," 建立新的文章 ")]),e("div",Ae,[e("div",$e,[e("table",Pe,[Ue,e("tbody",null,[(a(!0),c(M,null,$(s.articles,l=>(a(),c("tr",{key:l.id},[e("td",null,[e("p",Le,w(l.title),1)]),e("td",null,w(l.author),1),e("td",null,[e("p",Ne,w(l.description),1)]),e("td",null,w(o.$filters.date(l.create_at)),1),e("td",null,[e("div",De,[g(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:l.id,"onUpdate:modelValue":p=>l.isPublic=p,onChange:p=>d.switchUpdate(l)},null,40,Ie),[[P,l.isPublic]]),e("label",{class:"form-check-label",for:l.id},[l.isPublic?(a(),c("span",Se,"公開")):(a(),c("span",Oe,"不公開"))],8,Ee)])]),e("td",null,[e("div",Fe,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:p=>d.getArticleItem(l.id)}," 編輯 ",8,Be),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:p=>d.openModal("delete",l)}," 刪除 ",8,Je)])])]))),128))])])])]),r(C,{ref:"articleModal","temp-content":s.temp,"is-new":s.isNew,onUpdateArticle:d.updateArticle},null,8,["temp-content","is-new","onUpdateArticle"]),r(v,{ref:"deleteModal",item:s.temp,onDeleteItem:d.deleteItem},null,8,["item","onDeleteItem"]),r(k,{pages:s.pagination,onChangePage:d.getArticles,"get-list":d.getArticles},null,8,["pages","onChangePage","get-list"])],64)}const Ke=A(Ve,[["render",Re]]);export{Ke as default};
