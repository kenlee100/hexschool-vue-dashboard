import{m as I,M as N,P as D,D as A}from"./PaginationComponent-2e8f1cb5.js";import{t as g}from"./toast-fd7fed87.js";import{u as m}from"./common-fa42df3b.js";import{C as F}from"./ckeditor-e402a47d.js";import{_ as $,r as f,o as l,c as i,a as e,f as r,g as O,w as v,v as V,F as x,h as E,t as b,j as R,n as C,k as L}from"./index-9c9f8a0e.js";const{VITE__URL:M,VITE__PATH:P}={VITE__PATH:"ken100",VITE__URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-dashboard",MODE:"production",DEV:!1,PROD:!0},S={data(){return{modal:{},newTempContent:{imagesUrl:[]},editor:F,editorConfig:{toolbar:["heading","bold","italic","|","link"]}}},props:{tempContent:{type:Object,default(){}},isNew:{type:Boolean,default:!1}},watch:{tempContent(){this.newTempContent=this.tempContent}},methods:{createImage(){let n=null;this.newTempContent.imagesUrl&&(n=this.newTempContent.imagesUrl.length);const t={id:new Date().getTime(),num:n+=1};this.newTempContent.imagesUrl?this.newTempContent.imagesUrl.push(t):(this.newTempContent.imagesUrl=[],this.newTempContent.imagesUrl.push(t))},deleteImage(n){this.newTempContent.imagesUrl.forEach((t,d)=>{t.id===n.id&&this.newTempContent.imagesUrl.splice(d,1)})},uploadFile(n){m().isLoading=!0;const t=new FormData;if(n==="main-file"){const d=this.$refs[n];t.append(d.name,d.files[0]),this.$http.post(`${M}/api/${P}/admin/upload/`,t).then(p=>{m().isLoading=!1,this.newTempContent.imageUrl=p.data.imageUrl}).catch(p=>{m().isLoading=!1,g.fire({icon:"error",title:`${p.response.data.message}`})})}else{const d=this.$refs[n][0],p=parseInt(d.dataset.num);t.append(d.name,d.files[0]),this.$http.post(`${M}/api/${P}/admin/upload/`,t).then(o=>{m().isLoading=!1,this.newTempContent.imagesUrl[p].imageUrl=o.data.imageUrl}).catch(o=>{g.fire({icon:"error",title:`${o.response.data.message}`})})}}},mixins:[I],mounted(){this.$refs.modal.addEventListener("hidden.bs.modal",()=>{this.newTempContent={imagesUrl:[]}}),this.modal=new N(this.$refs.modal,{backdrop:"static",keyboard:!1})}},B={ref:"modal",class:"modal fade"},q={class:"modal-dialog modal-xl"},H={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},j={id:"productModalLabel",class:"modal-title"},z={key:0},G={key:1},K={class:"modal-body"},Q={class:"row"},W={class:"col-sm-4"},X={class:"image-upload-section d-flex flex-column"},Y={class:"mb-2"},Z={class:"mb-3"},ee=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),te={class:"input-group"},oe=["src"],se={key:1,class:"img-fluid",src:"https://placehold.co/640x480?text=No+Photo",alt:""},ne={class:"mb-3"},le={key:0,class:"d-flex flex-column overflow-auto"},ie={class:"form-label"},ae={class:"form-group"},de=["placeholder","onUpdate:modelValue"],re=["name","onChange","data-num"],ce=["src"],me={key:1,class:"img-fluid",src:"https://placehold.co/640x480?text=No+Photo",alt:""},pe=["onClick"],ue={class:"col-sm-8"},he={class:"mb-3"},_e=e("label",{for:"title",class:"form-label"},"標題",-1),ge={class:"row"},fe={class:"mb-3 col-md-6"},be=e("label",{for:"category",class:"form-label"},"分類",-1),we={class:"mb-3 col-md-6"},Ce=e("label",{for:"unit",class:"form-label"},"單位",-1),ve={class:"row"},Te={class:"mb-3 col-md-6"},ye=e("label",{for:"origin_price",class:"form-label"},"原價",-1),Ue={class:"mb-3 col-md-6"},ke=e("label",{for:"price",class:"form-label"},"售價",-1),Ve=e("hr",null,null,-1),xe={class:"mb-3"},Me=e("label",{for:"description",class:"form-label"},"產品描述",-1),Pe={class:"mb-3"},$e=e("label",{for:"content",class:"form-label"},"說明內容",-1),Ee={class:"mb-3"},Le={class:"form-check form-switch"},Ie={class:"form-check-label",for:"switch-activated"},Ne={key:0,class:"text-success"},De={key:1,class:"text-danger"},Ae={class:"modal-footer"},Fe={type:"submit",class:"btn btn-primary"};function Oe(n,t,d,p,o,c){const h=f("VField"),_=f("ErrorMessage"),U=f("ckeditor"),a=f("VForm");return l(),i("div",B,[e("div",q,[e("div",H,[r(a,{onSubmit:t[13]||(t[13]=u=>n.$emit("update-product",o.newTempContent))},{default:O(({errors:u})=>[e("div",J,[e("h5",j,[d.isNew?(l(),i("span",z,"新增產品")):(l(),i("span",G,"編輯產品"))]),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...s)=>n.closeModal&&n.closeModal(...s))})]),e("div",K,[e("div",Q,[e("div",W,[e("div",X,[e("div",Y,[e("div",Z,[ee,v(e("input",{type:"text",class:"form-control",placeholder:"請輸入主要圖片連結","onUpdate:modelValue":t[1]||(t[1]=s=>o.newTempContent.imageUrl=s)},null,512),[[V,o.newTempContent.imageUrl]]),e("div",te,[e("input",{type:"file",class:"form-control",name:"main-file-upload",onChange:t[2]||(t[2]=s=>c.uploadFile("main-file")),ref:"main-file"},null,544)]),o.newTempContent.imageUrl?(l(),i("img",{key:0,class:"img-fluid",src:o.newTempContent.imageUrl,alt:""},null,8,oe)):(l(),i("img",se))])]),e("div",ne,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[3]||(t[3]=(...s)=>c.createImage&&c.createImage(...s))}," 新增其他圖片欄位 ")])]),Array.isArray(o.newTempContent.imagesUrl)?(l(),i("div",le,[(l(!0),i(x,null,E(o.newTempContent.imagesUrl,(s,w)=>(l(),i("div",{key:s.id,class:"py-3 border-bottom"},[e("label",ie,"圖片 "+b(s.num),1),e("div",ae,[v(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片"+s.num+"連結","onUpdate:modelValue":k=>o.newTempContent.imagesUrl[w].imageUrl=k},null,8,de),[[V,o.newTempContent.imagesUrl[w].imageUrl]]),e("input",{type:"file",class:"form-control",name:"file-upload-"+(w+1),ref_for:!0,ref:"ref-file-"+(w+1),onChange:k=>c.uploadFile("ref-file-"+(w+1)),"data-num":w},null,40,re),s.imageUrl?(l(),i("img",{key:0,class:"img-fluid",src:s.imageUrl,alt:""},null,8,ce)):(l(),i("img",me))]),e("div",null,[e("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:k=>c.deleteImage(s)}," 刪除圖片 "+b(s.num),9,pe)])]))),128))])):R("",!0)]),e("div",ue,[e("div",he,[_e,r(h,{id:"title",name:"title",label:"標題",type:"text",class:C(["form-control",{"is-invalid":u.title}]),placeholder:"請輸入標題",rules:"required",modelValue:o.newTempContent.title,"onUpdate:modelValue":t[4]||(t[4]=s=>o.newTempContent.title=s)},null,8,["class","modelValue"]),r(_,{name:"title",class:"text-danger"})]),e("div",ge,[e("div",fe,[be,r(h,{name:"category",label:"分類",id:"category",type:"text",class:C(["form-control",{"is-invalid":u.category}]),placeholder:"請輸入分類",rules:"required",modelValue:o.newTempContent.category,"onUpdate:modelValue":t[5]||(t[5]=s=>o.newTempContent.category=s)},null,8,["class","modelValue"]),r(_,{name:"category",class:"text-danger"})]),e("div",we,[Ce,r(h,{id:"unit",label:"單位",name:"unit",type:"text",class:C(["form-control",{"is-invalid":u.unit}]),placeholder:"請輸入單位",rules:"required",modelValue:o.newTempContent.unit,"onUpdate:modelValue":t[6]||(t[6]=s=>o.newTempContent.unit=s)},null,8,["class","modelValue"]),r(_,{name:"unit",class:"text-danger"})])]),e("div",ve,[e("div",Te,[ye,r(h,{id:"origin_price",type:"number",name:"origin_price",label:"原價",min:"0",class:C(["form-control",{"is-invalid":u.origin_price}]),placeholder:"請輸入原價",rules:"required",modelValue:o.newTempContent.origin_price,"onUpdate:modelValue":t[7]||(t[7]=s=>o.newTempContent.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),r(_,{name:"origin_price",class:"text-danger"})]),e("div",Ue,[ke,r(h,{id:"price",name:"price",label:"售價",type:"number",min:"0",class:C(["form-control",{"is-invalid":u.price}]),placeholder:"請輸入售價",rules:"required",modelValue:o.newTempContent.price,"onUpdate:modelValue":t[8]||(t[8]=s=>o.newTempContent.price=s),modelModifiers:{number:!0}},null,8,["modelValue","class"]),r(_,{name:"price",class:"text-danger"})])]),Ve,e("div",xe,[Me,v(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[9]||(t[9]=s=>o.newTempContent.description=s)},`
                  `,512),[[V,o.newTempContent.description]])]),e("div",Pe,[$e,r(U,{editor:o.editor,config:o.editorConfig,modelValue:o.newTempContent.content,"onUpdate:modelValue":t[10]||(t[10]=s=>o.newTempContent.content=s)},null,8,["editor","config","modelValue"])]),e("div",Ee,[e("div",Le,[v(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"switch-activated","true-value":1,"false-value":0,"onUpdate:modelValue":t[11]||(t[11]=s=>o.newTempContent.is_enabled=s)},null,512),[[L,o.newTempContent.is_enabled]]),e("label",Ie,[o.newTempContent.is_enabled?(l(),i("span",Ne,"已啟用")):(l(),i("span",De,"未啟用"))])])])])])]),e("div",Ae,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[12]||(t[12]=(...s)=>n.closeModal&&n.closeModal(...s))}," 取消 "),e("button",Fe,b(d.isNew?"新增產品":"修改產品"),1)])]),_:1})])])],512)}const Re=$(S,[["render",Oe]]),{VITE__URL:T,VITE__PATH:y}={VITE__PATH:"ken100",VITE__URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-dashboard",MODE:"production",DEV:!1,PROD:!0},Se={data(){return{products:[],temp:{imagesUrl:[]},pagination:{},isNew:!1,productId:""}},components:{PaginationComponent:D,AdminProductModal:Re,DelModal:A},methods:{getProducts(n=1){m().isLoading=!0,this.$http.get(`${T}/api/${y}/admin/products/?page=${n}`).then(t=>{this.products=t.data.products,this.pagination=t.data.pagination,m().isLoading=!1}).catch(t=>{m().isLoading=!1,g.fire({icon:"error",title:`${t.response.data.message}`})})},openModal(n,t){n==="new"?(this.isNew=!0,this.$refs.productModal.openModal(),this.temp={imagesUrl:[]}):n==="edit"?(this.isNew=!1,this.temp=JSON.parse(JSON.stringify(t)),this.$refs.productModal.openModal()):n==="delete"&&(this.temp=JSON.parse(JSON.stringify(t)),this.$refs.deleteProductModal.openModal())},deleteItem(n){m().isProcessing=!0,this.$http.delete(`${T}/api/${y}/admin/product/${n}`).then(t=>{this.$refs.deleteProductModal.closeModal(),this.getProducts(),g.fire({icon:"success",title:t.data.message})}).catch(t=>{m().isLoading=!1,g.fire({icon:"error",title:`${t.response.data.message}`})})},updateProduct(n){m().isProcessing=!0;let t=`${T}/api/${y}/admin/product`,d="post";this.isNew||(t=`${T}/api/${y}/admin/product/${n.id}`,d="put"),this.$http[d](t,{data:n}).then(p=>{this.$refs.productModal.closeModal(),this.getProducts(),this.isNew=!1,g.fire({icon:"success",title:p.data.message})}).catch(p=>{m().isLoading=!1,g.fire({icon:"error",title:`${p.response.data.message}`})})}},mounted(){m().isLoading=!0,this.getProducts()}},Be={class:"text-end mt-4"},qe={class:"mt-4 mb-4 p-3 bg-white shadow-sm"},He={class:"table-responsive"},Je={class:"table table-striped table-hover mb-0"},je=e("thead",{class:"table-light"},[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120",class:"text-end"},"原價"),e("th",{width:"120",class:"text-end"},"售價"),e("th",{width:"120"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),ze={class:"mb-0 line-clamp-2"},Ge={class:"text-end"},Ke={class:"text-end"},Qe={class:"form-check form-switch"},We=["id","onUpdate:modelValue","onChange"],Xe=["for"],Ye={key:0,class:"text-success"},Ze={key:1,class:"text-danger"},et={class:"btn-group"},tt=["onClick"],ot=["onClick"];function st(n,t,d,p,o,c){const h=f("AdminProductModal"),_=f("DelModal"),U=f("PaginationComponent");return l(),i(x,null,[e("div",Be,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=a=>c.openModal("new"))}," 建立新的產品 ")]),e("div",qe,[e("div",He,[e("table",Je,[je,e("tbody",null,[(l(!0),i(x,null,E(o.products,a=>(l(),i("tr",{key:a.id},[e("td",null,b(a.category),1),e("td",null,[e("p",ze,b(a.title),1)]),e("td",Ge,b(a.origin_price),1),e("td",Ke,b(a.price),1),e("td",null,[e("div",Qe,[v(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:a.id,"onUpdate:modelValue":u=>a.is_enabled=u,"true-value":1,"false-value":0,onChange:u=>c.updateProduct(a)},null,40,We),[[L,a.is_enabled]]),e("label",{class:"form-check-label",for:a.id},[a.is_enabled?(l(),i("span",Ye,"啟用")):(l(),i("span",Ze,"未啟用"))],8,Xe)])]),e("td",null,[e("div",et,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:u=>c.openModal("edit",a)}," 編輯 ",8,tt),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>c.openModal("delete",a)}," 刪除 ",8,ot)])])]))),128))])])])]),r(h,{ref:"productModal","temp-content":o.temp,"is-new":o.isNew,onUpdateProduct:c.updateProduct},null,8,["temp-content","is-new","onUpdateProduct"]),r(_,{ref:"deleteProductModal",item:o.temp,onDeleteItem:c.deleteItem},null,8,["item","onDeleteItem"]),r(U,{pages:o.pagination,onChangePage:c.getProducts,"get-list":c.getProducts},null,8,["pages","onChangePage","get-list"])],64)}const rt=$(Se,[["render",st]]);export{rt as default};
