import{m as V,M as x,D as A,P as U}from"./PaginationComponent-86b3f4b1.js";import{C as P}from"./ckeditor-c1425c37.js";import{_ as T,r as b,o as i,c as a,a as t,w as r,v as m,F as y,g as k,i as $,e as g,j as M,t as f}from"./index-4535df0f.js";const L={data(){return{modal:{},newTempContent:{tag:[]},create_at:0,editor:P,editorConfig:{toolbar:["heading","typing","bold","italic","|","link"]}}},props:{tempContent:{type:Object,default(){}},isNew:{type:Boolean,default:!1}},watch:{tempContent(){this.newTempContent={...this.tempContent,tag:this.tempContent.tag||[],isPublic:this.tempContent.isPublic||!1},[this.create_at,this.secondVal]=new Date(this.newTempContent.create_at*1e3).toISOString().split("T")},create_at(){this.newTempContent.create_at=Math.floor(new Date(this.create_at)/1e3)}},mixins:[V],mounted(){this.$refs.modal.addEventListener("hidden.bs.modal",()=>{this.newTempContent={tag:[]}}),this.modal=new x(this.$refs.modal,{backdrop:"static",keyboard:!1})}},D={ref:"modal",class:"modal fade"},N={class:"modal-dialog modal-xl"},I={class:"modal-content border-0"},E={class:"modal-header bg-dark text-white"},O={class:"modal-title"},S={key:0},B={key:1},J={class:"modal-body"},R={class:"row"},j={class:"col-sm-4"},F={class:"mb-3"},H=t("label",{for:"title",class:"form-label"},"標題",-1),q={class:"mb-3"},z=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),G=["src"],K={class:"mb-3"},Q=t("label",{for:"author",class:"form-label"},"作者",-1),W={class:"mb-3"},X=t("label",{for:"create_at"},"文章建立日期",-1),Y={class:"col-sm-8"},Z=t("label",{for:"tag",class:"form-label"},"標籤",-1),tt={class:"row gx-1 mb-3"},et={class:"input-group input-group-sm"},st=["onUpdate:modelValue"],ot=["onClick"],nt=t("i",{class:"bi bi-x"},null,-1),lt=[nt],it={key:0,class:"col-auto mb-1"},at={class:"mb-3"},dt=t("label",{for:"description",class:"form-label"},"文章描述",-1),ct={class:"mb-3"},rt={class:"mb-3"},pt={class:"form-check form-switch"},mt={class:"form-check-label",for:"switch-public"},ht={key:0,class:"text-success"},ut={key:1,class:"text-danger"},_t={class:"modal-footer"};function bt(o,e,c,_,s,d){const v=b("ckeditor");return i(),a("div",D,[t("div",N,[t("div",I,[t("div",E,[t("h5",O,[c.isNew?(i(),a("span",S,"新增貼文")):(i(),a("span",B,"編輯貼文"))]),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...n)=>o.closeModal&&o.closeModal(...n))})]),t("div",J,[t("div",R,[t("div",j,[t("div",F,[H,r(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[1]||(e[1]=n=>s.newTempContent.title=n),placeholder:"請輸入標題"},null,512),[[m,s.newTempContent.title]])]),t("div",q,[z,r(t("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":e[2]||(e[2]=n=>s.newTempContent.imageUrl=n),placeholder:"請輸入圖片連結"},null,512),[[m,s.newTempContent.imageUrl]]),t("img",{class:"img-fluid",src:s.newTempContent.imageUrl,alt:""},null,8,G)]),t("div",K,[Q,r(t("input",{type:"text",class:"form-control",id:"author","onUpdate:modelValue":e[3]||(e[3]=n=>s.newTempContent.author=n),placeholder:"請輸入標題"},null,512),[[m,s.newTempContent.author]])]),t("div",W,[X,r(t("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":e[4]||(e[4]=n=>s.create_at=n)},null,512),[[m,s.create_at]])])]),t("div",Y,[Z,t("div",tt,[(i(!0),a(y,null,k(s.newTempContent.tag,(n,p)=>(i(),a("div",{class:"col-md-2 mb-1",key:p},[t("div",et,[r(t("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":w=>s.newTempContent.tag[p]=w,placeholder:"請輸入標籤"},null,8,st),[[m,s.newTempContent.tag[p]]]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:w=>s.newTempContent.tag.splice(p,1)},lt,8,ot)])]))),128)),s.newTempContent.tag[s.newTempContent.tag.length-1]||!s.newTempContent.tag.length?(i(),a("div",it,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:e[5]||(e[5]=n=>s.newTempContent.tag.push(""))}," 新增標籤 ")])):$("",!0)]),t("div",at,[dt,r(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[6]||(e[6]=n=>s.newTempContent.description=n),placeholder:"請輸入文章描述"},null,512),[[m,s.newTempContent.description]])]),t("div",ct,[g(v,{editor:s.editor,config:s.editorConfig,modelValue:s.newTempContent.content,"onUpdate:modelValue":e[7]||(e[7]=n=>s.newTempContent.content=n)},null,8,["editor","config","modelValue"])]),t("div",rt,[t("div",pt,[r(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"switch-public","onUpdate:modelValue":e[8]||(e[8]=n=>s.newTempContent.isPublic=n)},null,512),[[M,s.newTempContent.isPublic]]),t("label",mt,[s.newTempContent.isPublic?(i(),a("span",ht,"公開")):(i(),a("span",ut,"不公開"))])])])])])]),t("div",_t,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[9]||(e[9]=(...n)=>o.closeModal&&o.closeModal(...n))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[10]||(e[10]=n=>o.$emit("update-article",s.newTempContent))},f(c.isNew?"確認新增":"確認修改"),1)])])])],512)}const gt=T(L,[["render",bt]]),{VITE__URL:h,VITE__PATH:u}={VITE__PATH:"ken100",VITE__URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-dashboard",MODE:"production",DEV:!1,PROD:!0},ft={data(){return{isLoading:!1,modal:{},articles:[],temp:{isPublic:!1,create_at:new Date().getTime()/1e3,tag:[]},pagination:{},isNew:!1}},methods:{getArticles(o=1){this.isLoading=!0,this.$http.get(`${h}/api/${u}/admin/articles/?page=${o}`).then(e=>{this.articles=e.data.articles,this.pagination=e.data.pagination,this.isLoading=!1}).catch(e=>{alert(`${e.response.data.message}`),this.isLoading=!1})},getArticleItem(o){this.isLoading=!0,this.$http.get(`${h}/api/${u}/admin/article/${o}`).then(e=>{this.openModal("edit",e.data.article),this.isLoading=!1}).catch(e=>{alert(`${e.response.data.message}`),this.isLoading=!1})},openModal(o,e){o==="new"?(this.isNew=!0,this.$refs.articleModal.openModal(),this.temp={isPublic:!1,create_at:new Date().getTime()/1e3,tag:[]}):o==="edit"?(this.isNew=!1,this.temp=JSON.parse(JSON.stringify(e)),this.$refs.articleModal.openModal()):o==="delete"&&(this.temp=JSON.parse(JSON.stringify(e)),this.$refs.deleteModal.openModal())},deleteItem(o){this.$http.delete(`${h}/api/${u}/admin/article/${o}`).then(e=>{this.getArticles(),this.$refs.deleteModal.closeModal(),alert(e.data.message)}).catch(e=>{alert(`${e.response.data.message}`)})},async updateArticle(o){let e=`${h}/api/${u}/admin/article`,c="post";this.isNew||(e=`${h}/api/${u}/admin/article/${o.id}`,c="put"),this.$http[c](e,{data:o}).then(_=>{this.$refs.articleModal.closeModal(),this.getArticles(),alert(_.data.message)}).catch(_=>{alert(_.response.data.message)})},async switchUpdate(o){try{const c={...(await this.$http.get(`${h}/api/${u}/admin/article/${o.id}`)).data.article,isPublic:o.isPublic};await this.updateArticle(c)}catch(e){alert(e.response.data.message)}}},mounted(){this.isLoading=!0,this.getArticles()},components:{AdminArticleModalVue:gt,DelModal:A,PaginationComponent:U}},wt={class:"text-end mt-4"},Ct={class:"mt-4 mb-4 p-3 bg-white shadow-sm"},vt={class:"table-responsive"},yt={class:"table table-striped table-hover mb-0"},Tt=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{width:"200px"}},"標題"),t("th",{style:{width:"200px"}},"作者"),t("th",null,"描述"),t("th",{style:{width:"100px"}},"建立時間"),t("th",{style:{width:"100px"}},"是否公開"),t("th",{style:{width:"120px"}},"編輯")])],-1),kt={class:"form-check form-switch"},Mt=["id","onUpdate:modelValue","onChange"],Vt=["for"],xt={key:0,class:"text-success"},At={key:1,class:"text-danger"},Ut={class:"btn-group"},Pt=["onClick"],$t=["onClick"];function Lt(o,e,c,_,s,d){const v=b("AdminArticleModalVue"),n=b("DelModal"),p=b("PaginationComponent"),w=b("VueLoading");return i(),a(y,null,[t("div",wt,[t("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=l=>d.openModal("new"))}," 建立新的文章 ")]),t("div",Ct,[t("div",vt,[t("table",yt,[Tt,t("tbody",null,[(i(!0),a(y,null,k(s.articles,l=>(i(),a("tr",{key:l.id},[t("td",null,f(l.title),1),t("td",null,f(l.author),1),t("td",null,f(l.description),1),t("td",null,f(o.$filters.date(l.create_at)),1),t("td",null,[t("div",kt,[r(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:l.id,"onUpdate:modelValue":C=>l.isPublic=C,onChange:C=>d.switchUpdate(l)},null,40,Mt),[[M,l.isPublic]]),t("label",{class:"form-check-label",for:l.id},[l.isPublic?(i(),a("span",xt,"公開")):(i(),a("span",At,"不公開"))],8,Vt)])]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:C=>d.getArticleItem(l.id)}," 編輯 ",8,Pt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:C=>d.openModal("delete",l)}," 刪除 ",8,$t)])])]))),128))])])])]),g(v,{ref:"articleModal","temp-content":s.temp,"is-new":s.isNew,onUpdateArticle:d.updateArticle},null,8,["temp-content","is-new","onUpdateArticle"]),g(n,{ref:"deleteModal",item:s.temp,onDeleteItem:d.deleteItem},null,8,["item","onDeleteItem"]),g(p,{pages:s.pagination,onChangePage:d.getArticles,"get-data":d.getArticles},null,8,["pages","onChangePage","get-data"]),g(w,{active:s.isLoading,"onUpdate:active":e[1]||(e[1]=l=>s.isLoading=l)},null,8,["active"])],64)}const Et=T(ft,[["render",Lt]]);export{Et as default};
