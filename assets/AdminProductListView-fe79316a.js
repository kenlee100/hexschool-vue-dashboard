import{m as M,M as V,D as L}from"./DelModal-b1c41c76.js";import{_ as y,o as l,c as i,a as e,f as m,v as p,F as C,e as k,t as h,h as E,k as P,r as g,b}from"./index-095202d5.js";import{P as I}from"./Pagination-c2161e69.js";const{VITE__URL:T,VITE__PATH:U}={VITE__PATH:"ken100",VITE__URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-dashboard",MODE:"production",DEV:!1,PROD:!0},$={data(){return{modal:{},newTempContent:{imagesUrl:[]}}},props:{tempContent:{type:Object,default(){}},isNew:{type:Boolean,default:!1}},watch:{tempContent(){this.newTempContent=this.tempContent}},methods:{createImage(){let n=null;this.newTempContent.imagesUrl&&(n=this.newTempContent.imagesUrl.length);const t={id:new Date().getTime(),num:n+=1};this.newTempContent.imagesUrl?this.newTempContent.imagesUrl.push(t):(this.newTempContent.imagesUrl=[],this.newTempContent.imagesUrl.push(t))},deleteImage(n){this.newTempContent.imagesUrl.forEach((t,d)=>{t.id===n.id&&this.newTempContent.imagesUrl.splice(d,1)})},uploadFile(n){const t=new FormData;if(n==="main-file"){const d=this.$refs[n];t.append(d.name,d.files[0]),this.$http.post(`${T}/api/${U}/admin/upload/`,t).then(c=>{this.newTempContent.imageUrl=c.data.imageUrl}).catch(c=>{alert(c.response.data.message)})}else{const d=this.$refs[n][0],c=parseInt(d.dataset.num);t.append(d.name,d.files[0]),this.$http.post(`${T}/api/${U}/admin/upload/`,t).then(o=>{this.newTempContent.imagesUrl[c].imageUrl=o.data.imageUrl}).catch(o=>{alert(o.response.data.message)})}}},mixins:[M],mounted(){this.$refs.modal.addEventListener("hidden.bs.modal",()=>{this.newTempContent={imagesUrl:[]}}),this.modal=new V(this.$refs.modal,{backdrop:"static",keyboard:!1})}},D={ref:"modal",class:"modal fade"},N={class:"modal-dialog modal-xl"},A={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},R={id:"productModalLabel",class:"modal-title"},F={key:0},S={key:1},B={class:"modal-body"},H={class:"row"},J={class:"col-sm-4"},j={class:"image-upload-section d-flex flex-column"},q={class:"mb-2"},z={class:"mb-3"},G=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),K={class:"input-group"},Q=["src"],W={key:1,class:"img-fluid",src:"https://placehold.co/640x480?text=No+Photo",alt:""},X={class:"mb-3"},Y={key:0,class:"d-flex flex-column overflow-auto"},Z={class:"form-label"},ee={class:"form-group"},te=["placeholder","onUpdate:modelValue"],oe=["name","onChange","data-num"],se=["src"],ne={key:1,class:"img-fluid",src:"https://placehold.co/640x480?text=No+Photo",alt:""},le=["onClick"],ie={class:"col-sm-8"},ae={class:"mb-3"},de=e("label",{for:"title",class:"form-label"},"標題",-1),re={class:"row"},ce={class:"mb-3 col-md-6"},me=e("label",{for:"category",class:"form-label"},"分類",-1),pe={class:"mb-3 col-md-6"},ue=e("label",{for:"price",class:"form-label"},"單位",-1),he={class:"row"},_e={class:"mb-3 col-md-6"},fe=e("label",{for:"origin_price",class:"form-label"},"原價",-1),ge={class:"mb-3 col-md-6"},be=e("label",{for:"price",class:"form-label"},"售價",-1),we=e("hr",null,null,-1),ve={class:"mb-3"},Ce=e("label",{for:"description",class:"form-label"},"產品描述",-1),Te={class:"mb-3"},Ue=e("label",{for:"content",class:"form-label"},"說明內容",-1),ye={class:"mb-3"},ke={class:"form-check form-switch"},Pe={class:"form-check-label",for:"switch-activated"},xe={key:0,class:"text-success"},Me={key:1,class:"text-danger"},Ve={class:"modal-footer"};function Le(n,t,d,c,o,r){return l(),i("div",D,[e("div",N,[e("div",A,[e("div",O,[e("h5",R,[d.isNew?(l(),i("span",F,"新增產品")):(l(),i("span",S,"編輯產品"))]),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...s)=>n.closeModal&&n.closeModal(...s))})]),e("div",B,[e("div",H,[e("div",J,[e("div",j,[e("div",q,[e("div",z,[G,m(e("input",{type:"text",class:"form-control",placeholder:"請輸入主要圖片連結","onUpdate:modelValue":t[1]||(t[1]=s=>o.newTempContent.imageUrl=s)},null,512),[[p,o.newTempContent.imageUrl]]),e("div",K,[e("input",{type:"file",class:"form-control",name:"main-file-upload",onChange:t[2]||(t[2]=s=>r.uploadFile("main-file")),ref:"main-file"},null,544)]),o.newTempContent.imageUrl?(l(),i("img",{key:0,class:"img-fluid",src:o.newTempContent.imageUrl,alt:""},null,8,Q)):(l(),i("img",W))])]),e("div",X,[e("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[3]||(t[3]=(...s)=>r.createImage&&r.createImage(...s))}," 新增其他圖片欄位 ")])]),Array.isArray(o.newTempContent.imagesUrl)?(l(),i("div",Y,[(l(!0),i(C,null,k(o.newTempContent.imagesUrl,(s,u)=>(l(),i("div",{key:s.id,class:"py-3 border-bottom"},[e("label",Z,"圖片 "+h(s.num),1),e("div",ee,[m(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片"+s.num+"連結","onUpdate:modelValue":_=>o.newTempContent.imagesUrl[u].imageUrl=_},null,8,te),[[p,o.newTempContent.imagesUrl[u].imageUrl]]),e("input",{type:"file",class:"form-control",name:"file-upload-"+(u+1),ref_for:!0,ref:"ref-file-"+(u+1),onChange:_=>r.uploadFile("ref-file-"+(u+1)),"data-num":u},null,40,oe),s.imageUrl?(l(),i("img",{key:0,class:"img-fluid",src:s.imageUrl,alt:""},null,8,se)):(l(),i("img",ne))]),e("div",null,[e("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:_=>r.deleteImage(s)}," 刪除圖片 "+h(s.num),9,le)])]))),128))])):E("",!0)]),e("div",ie,[e("div",ae,[de,m(e("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[4]||(t[4]=s=>o.newTempContent.title=s)},null,512),[[p,o.newTempContent.title]])]),e("div",re,[e("div",ce,[me,m(e("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":t[5]||(t[5]=s=>o.newTempContent.category=s)},null,512),[[p,o.newTempContent.category]])]),e("div",pe,[ue,m(e("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":t[6]||(t[6]=s=>o.newTempContent.unit=s)},null,512),[[p,o.newTempContent.unit]])])]),e("div",he,[e("div",_e,[fe,m(e("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":t[7]||(t[7]=s=>o.newTempContent.origin_price=s)},null,512),[[p,o.newTempContent.origin_price,void 0,{number:!0}]])]),e("div",ge,[be,m(e("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":t[8]||(t[8]=s=>o.newTempContent.price=s)},null,512),[[p,o.newTempContent.price,void 0,{number:!0}]])])]),we,e("div",ve,[Ce,m(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[9]||(t[9]=s=>o.newTempContent.description=s)},`
                `,512),[[p,o.newTempContent.description]])]),e("div",Te,[Ue,m(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":t[10]||(t[10]=s=>o.newTempContent.content=s)},`
                `,512),[[p,o.newTempContent.content]])]),e("div",ye,[e("div",ke,[m(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"switch-activated","true-value":1,"false-value":0,"onUpdate:modelValue":t[11]||(t[11]=s=>o.newTempContent.is_enabled=s)},null,512),[[P,o.newTempContent.is_enabled]]),e("label",Pe,[o.newTempContent.is_enabled?(l(),i("span",xe,"已啟用")):(l(),i("span",Me,"未啟用"))])])])])])]),e("div",Ve,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[12]||(t[12]=(...s)=>n.closeModal&&n.closeModal(...s))}," 取消 "),e("button",{type:"button",class:"btn btn-primary",onClick:t[13]||(t[13]=s=>n.$emit("update-product",o.newTempContent))},h(d.isNew?"新增產品":"修改產品"),1)])])])],512)}const Ee=y($,[["render",Le]]),{VITE__URL:w,VITE__PATH:v}={VITE__PATH:"ken100",VITE__URL:"https://vue3-course-api.hexschool.io/v2",BASE_URL:"/hexschool-vue-dashboard",MODE:"production",DEV:!1,PROD:!0},Ie={data(){return{isLoading:!1,products:[],temp:{imagesUrl:[]},pagination:{},isNew:!1,productId:""}},components:{Pagination:I,AdminProductModal:Ee,DelModal:L},methods:{getProducts(n=1){this.isLoading=!0,this.$http.get(`${w}/api/${v}/admin/products/?page=${n}`).then(t=>{this.products=t.data.products,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{alert(`${t.response.data.message}`),this.isLoading=!1})},openModal(n,t){n==="new"?(this.isNew=!0,this.$refs.productModal.openModal(),this.temp={imagesUrl:[]}):n==="edit"?(this.isNew=!1,this.temp=JSON.parse(JSON.stringify(t)),this.$refs.productModal.openModal()):n==="delete"&&(this.temp=JSON.parse(JSON.stringify(t)),this.$refs.deleteProductModal.openModal())},deleteItem(n){this.$http.delete(`${w}/api/${v}/admin/product/${n}`).then(t=>{this.$refs.deleteProductModal.closeModal(),this.getProducts(),alert(t.data.message)}).catch(t=>{alert(`${t.response.data.message}`)})},updateProduct(n){let t=`${w}/api/${v}/admin/product`,d="post";this.isNew||(t=`${w}/api/${v}/admin/product/${n.id}`,d="put"),this.$http[d](t,{data:n}).then(c=>{this.$refs.productModal.closeModal(),this.getProducts(),alert(c.data.message)}).catch(c=>{alert(c.response.data.message)})}},mounted(){this.isLoading=!0,this.getProducts()}},$e={class:"text-end mt-4"},De={class:"mt-4 mb-4 p-3 bg-white shadow-sm"},Ne={class:"table-responsive"},Ae={class:"table table-striped table-hover mb-0"},Oe=e("thead",{class:"table-light"},[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120",class:"text-end"},"原價"),e("th",{width:"120",class:"text-end"},"售價"),e("th",{width:"120"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),Re={class:"text-end"},Fe={class:"text-end"},Se={class:"form-check form-switch"},Be=["id","onUpdate:modelValue","onChange"],He=["for"],Je={key:0,class:"text-success"},je={key:1,class:"text-danger"},qe={class:"btn-group"},ze=["onClick"],Ge=["onClick"];function Ke(n,t,d,c,o,r){const s=g("AdminProductModal"),u=g("DelModal"),_=g("Pagination"),x=g("VueLoading");return l(),i(C,null,[e("div",$e,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=a=>r.openModal("new"))}," 建立新的產品 ")]),e("div",De,[e("div",Ne,[e("table",Ae,[Oe,e("tbody",null,[(l(!0),i(C,null,k(o.products,a=>(l(),i("tr",{key:a.id},[e("td",null,h(a.category),1),e("td",null,h(a.title),1),e("td",Re,h(a.origin_price),1),e("td",Fe,h(a.price),1),e("td",null,[e("div",Se,[m(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:a.id,"onUpdate:modelValue":f=>a.is_enabled=f,"true-value":1,"false-value":0,onChange:f=>r.updateProduct(a)},null,40,Be),[[P,a.is_enabled]]),e("label",{class:"form-check-label",for:a.id},[a.is_enabled?(l(),i("span",Je,"啟用")):(l(),i("span",je,"未啟用"))],8,He)])]),e("td",null,[e("div",qe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:f=>r.openModal("edit",a)}," 編輯 ",8,ze),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:f=>r.openModal("delete",a)}," 刪除 ",8,Ge)])])]))),128))])])])]),b(s,{ref:"productModal","temp-content":o.temp,"is-new":o.isNew,onUpdateProduct:r.updateProduct},null,8,["temp-content","is-new","onUpdateProduct"]),b(u,{ref:"deleteProductModal",item:o.temp,onDeleteItem:r.deleteItem},null,8,["item","onDeleteItem"]),b(_,{pages:o.pagination,onChangePage:r.getProducts,"get-data":r.getProducts},null,8,["pages","onChangePage","get-data"]),b(x,{active:o.isLoading,"onUpdate:active":t[1]||(t[1]=a=>o.isLoading=a)},null,8,["active"])],64)}const Ye=y(Ie,[["render",Ke]]);export{Ye as default};
